name: Fork-sync

permissions:
  contents: write

on:
  schedule:
    - cron: "0 17 * * *"  # 每天北京时间凌晨1点运行 (UTC 17点)
  workflow_dispatch:  # 允许手动触发

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream repo
    runs-on: ubuntu-latest
    if: ${{ success() }}  # 不再依赖 fork 仓库

    steps:
      # Step 1: Checkout the target repository (your forked repository)
      - name: Checkout target repo
        uses: actions/checkout@v4

      # Step 2: Notify to manually sync (since no longer syncing with upstream repo)
      - name: Notify to manually sync
        run: |
          echo "Since upstream repository is disconnected, you need to manually sync your fork."
          echo "Please use GitHub's 'Sync fork' button or run 'git fetch upstream' manually."
          exit 0

      # Step 3: Delete workflow runs (keep only the most recent 5 workflow runs)
      - name: Delete workflow runs
        uses: Mattraks/delete-workflow-runs@main
        with:
          retain_days: 0
          keep_minimum_runs: 5
